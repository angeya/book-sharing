(function(t){function e(e){for(var n,s,r=e[0],l=e[1],c=e[2],f=0,d=[];f<r.length;f++)s=r[f],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&d.push(i[s][0]),i[s]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);u&&u(e);while(d.length)d.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var t,e=0;e<o.length;e++){for(var a=o[e],n=!0,r=1;r<a.length;r++){var l=a[r];0!==i[l]&&(n=!1)}n&&(o.splice(e--,1),t=s(s.s=a[0]))}return t}var n={},i={app:0},o=[];function s(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=n,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(a,n,function(e){return t[e]}.bind(null,n));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var u=l;o.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"1a39":function(t,e,a){"use strict";a("b245")},3031:function(t,e,a){"use strict";a("5e23")},"56d7":function(t,e,a){"use strict";a.r(e);a("cadf"),a("551c"),a("f751"),a("097d");var n=a("2b0e"),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},o=[],s={name:"app",components:{}},r=s,l=(a("ae2b"),a("2877")),c=Object(l["a"])(r,i,o,!1,null,"726551c1",null),u=c.exports,f=a("5c96"),d=a.n(f),p=(a("0fae"),a("8c4f")),h=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("h2",[t._v("欢迎使用电子书共享平台")]),a("div",{staticClass:"login-panel"},[a("h4",[t._v(t._s(t.currentAction))]),a("el-form",{ref:"form",staticClass:"login-form",attrs:{model:t.formData,"status-icon":"",rules:t.rules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"邮箱",prop:"mail"}},[a("el-input",{attrs:{type:"email",autocomplete:"off"},model:{value:t.formData.mail,callback:function(e){t.$set(t.formData,"mail",e)},expression:"formData.mail"}})],1),t.isLogin?t._e():a("el-form-item",{attrs:{label:"验证码",prop:"verifyCode"}},[a("el-input",{staticClass:"verify-code",attrs:{type:"text",autocomplete:"off"},model:{value:t.formData.verifyCode,callback:function(e){t.$set(t.formData,"verifyCode",e)},expression:"formData.verifyCode"}}),a("el-button",{staticClass:"verify-code-btn",attrs:{type:"success",size:"medium",plain:"",disabled:0!==t.codeTime},on:{click:t.getverifyCode}},[t._v(t._s(t.verifyCodeBtnText))])],1),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:t.formData.password,callback:function(e){t.$set(t.formData,"password",e)},expression:"formData.password"}})],1),t.isLogin?t._e():a("el-form-item",{attrs:{label:"确认密码",prop:"password2"}},[a("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:t.formData.password2,callback:function(e){t.$set(t.formData,"password2",e)},expression:"formData.password2"}})],1),a("el-form-item",[a("el-checkbox",{directives:[{name:"show",rawName:"v-show",value:!t.isLogin,expression:"!isLogin"}],attrs:{label:""},model:{value:t.loginAfterRegister,callback:function(e){t.loginAfterRegister=e},expression:"loginAfterRegister"}},[t._v("注册成功后登录")])],1),a("el-form-item",[a("el-button",{staticClass:"operate-btn",attrs:{type:"primary"},on:{click:t.submitForm}},[t._v(t._s(t.currentAction))]),a("el-button",{staticClass:"operate-btn",on:{click:t.switchPanel}},[t._v(t._s(t.switchAction))])],1)],1)],1)])},g=[],m=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/,y=/^\d{4}$/,b={name:"Login",data:function(){var t=this,e=function(t,e,a){""===e?a(new Error("请输入邮箱")):m.test(e)?a():a(new Error("邮箱格式不正确"))},a=function(t,e,a){""===e?a(new Error("请输入验证码")):y.test(e)?a():a(new Error("验证码应为4位数字"))},n=function(e,a,n){""===a?n(new Error("请输入密码")):(""!==t.formData.password&&t.$refs.form.validateField("validatePassword2"),n())},i=function(e,a,n){""===a?n(new Error("请确认密码")):a!==t.formData.password?n(new Error("两次密码不一致")):n()};return{isLogin:!0,loginAfterRegister:!0,isGetCode:!0,codeTime:0,formData:{mail:"",verifyCode:"",password:"",password2:""},rules:{mail:[{validator:e,trigger:"blur"}],verifyCode:[{validator:a,trigger:"blur"}],password:[{validator:n,trigger:"blur"}],password2:[{validator:i,trigger:"blur"}]}}},computed:{currentAction:function(){return this.isLogin?"登录":"注册"},switchAction:function(){return this.isLogin?"去注册":"去登录"},verifyCodeBtnText:function(){return 0===this.codeTime?"获取验证码":"".concat(this.codeTime," s后可重试")}},methods:{submitForm:function(){this.isLogin?this.login():this.register()},login:function(){var t=this,e=this;this.$refs["form"].validate((function(a){if(!a)return!1;t.axios({url:"user/login",data:{mail:e.formData.mail,password:e.formData.password},method:"post"}).then((function(a){0===a.data.code?(e.$notify.successEx({title:"登录成功",content:""}),e.$store.commit("saveUserInfo",{userInfo:a.data.data}),t.$router.push({name:"main"})):e.$notify.errorEx({title:"登录失败",content:"用户名或者密码错误！"})}))}))},register:function(){var t=this,e=this;this.$refs["form"].validate((function(a){if(!a)return!1;t.axios({url:"user/createUser",data:{mail:e.formData.mail,verifyCode:e.formData.verifyCode,password:e.formData.password},method:"post"}).then((function(a){0===a.data.code?(e.$notify.successEx({title:"注册成功",content:""}),t.loginAfterRegister&&e.login()):100===a.data.code?e.$notify.errorEx({title:"注册失败",content:"用户名已经存在！"}):a.data.code>=300&&e.$notify.errorEx({title:"注册失败",content:a.data.msg})}))}))},getverifyCode:function(){var t=this,e=this;e.isGetCode=!1,this.$refs["form"].validateField("mail",(function(a){a||t.axios({url:"user/getVerifyCode",data:e.formData.mail.replaceAll("@",".._.."),method:"post"}).then((function(t){0===t.data.code?e.countDown():e.$notify.errorEx({title:"获取验证码失败"})}))}))},countDown:function(){var t=this;this.codeTime=60;var e=setInterval((function(){t.codeTime>0?t.codeTime--:clearInterval(e)}),1e3)},switchPanel:function(){this.isLogin=!this.isLogin}}},v=b,S=(a("efc5"),Object(l["a"])(v,h,g,!1,null,"504e3580",null)),C=S.exports,w=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("header",{staticClass:"header-container"},[t._m(0),a("div",{staticClass:"user-info-container"},[a("el-popover",{attrs:{placement:"bottom",trigger:"hover"}},[a("el-button",{staticClass:"logout-btn",attrs:{type:"success"},on:{click:t.applyStorage}},[t._v("申请上传空间")]),a("el-button",{staticClass:"logout-btn",attrs:{type:"info"},on:{click:t.logout}},[t._v("注销登录")]),a("div",{staticClass:"user-info",attrs:{slot:"reference"},slot:"reference"},[a("h4",[t._v(t._s(t.userInfo.name))]),a("h4",[t._v("身份："+t._s(t.userTypes[t.userInfo.role]))])])],1)],1),a("div",{staticClass:"user-storage-container"},[a("div",{staticClass:"storage-detail"},[a("p",[t._v("已用空间: "+t._s(t.storageInfo.usedSpace))]),a("p",[t._v("全部空间: "+t._s(t.storageInfo.totalSpace))])]),a("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:t.storageInfo.percentage,status:"success"}},[t._v("ok\n      ")])],1)]),a("main",{staticClass:"main-container"},[a("el-menu",{attrs:{"default-active":t.activeTab},on:{select:t.handleSelect}},t._l(t.menuItems,(function(e,n){return a("el-menu-item",{key:n,attrs:{index:e.name}},[a("em",{class:e.iconClass}),a("span",[t._v(t._s(e.label))])])})),1),a("router-view")],1),a("div",{staticClass:"dialog-container"},[a("el-dialog",{attrs:{title:"提示",visible:t.isShowDialog,width:"30%"},on:{"update:visible":function(e){t.isShowDialog=e}}},[a("p",[t._v("功能暂未上线，可联系管理员（sunnyajie@163.com）增加存储空间！")]),a("p",[t._v("(限制上传空间的目的是为了防止多度上传导致服务器存储空间不足，给您带来不便，敬请谅解！)")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.isShowDialog=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.isShowDialog=!1}}},[t._v("got it")])],1)])],1)])},E=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"welcome-container"},[a("h2",[t._v(" 欢迎使用电子书共享平台！")])])}],_=(a("c5f6"),a("7f7f"),{LABELS_SEPARATOR:"#*#",LABELS_SHOW_SEPARATOR:" | ",REQUEST_SUCCESS:0,REQUEST_FILE_NAME_EXIST:200,COMMON_DATE_FORMAT:"yyyy-MM-dd hh:mm",USER_TYPES:["超级管理员","管理员","用户"],UPDATE_STORAGE_INFO:"UPDATE_STORAGE_INFO"}),x=(a("3b2b"),a("a481"),{formatDate:function(t,e){var a={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"H+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),fff:t.getMilliseconds()},n=e;for(var i in/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+i+")").test(n)&&(n=n.replace(RegExp.$1,1===RegExp.$1.length?a[i]:("00"+a[i]).substr((""+a[i]).length)));return n},byteToMFormat:function(t){return(t/1024/1024).toFixed(3)+"M"},kToMFormat:function(t){return(t/1024).toFixed(3)+"M"},kToM:function(t){return t/1024},splitLabels:function(t){return t.replace(/#\*#/g,_.LABELS_SHOW_SEPARATOR)}}),k=[{name:"bookList",label:"列表浏览",iconClass:"el-icon-document"},{name:"bookUpload",label:"上传电子书",iconClass:"el-icon-upload"},{name:"bookManagement",label:"电子书管理",iconClass:"el-icon-menu"}],D={name:"Main",data:function(){return{userInfo:{name:"",role:0},isShowDialog:!1,menuItems:k,userTypes:_.USER_TYPES,storageInfo:{usedSpace:"",totalSpace:"",percentage:0},activeTab:k[0].name}},methods:{handleSelect:function(t){this.$router.push({name:t})},logout:function(){var t=this;this.axios({url:"/user/logout",method:"get"}).then((function(e){e.data.code===_.REQUEST_SUCCESS&&t.toLoginPage()}))},checkLogin:function(){var t=this,e=this;this.axios({url:"/user/isLogin",method:"get"}).then((function(a){null!==a.data&&a.data.code===_.REQUEST_SUCCESS?(t.userInfo=t.$store.getters.getUserInfo,t.getStorageInfo()):e.toLoginPage()}))},toLoginPage:function(){this.$router.push({name:"login"})},setActiveTab:function(){this.activeTab=this.$route.name},getStorageInfo:function(){var t=this;this.axios({url:"/user/getStorageInfo",method:"get"}).then((function(e){var a=e.data;a.code===_.REQUEST_SUCCESS&&(t.storageInfo.usedSpace=x.kToMFormat(a.data.usedSpace),t.storageInfo.totalSpace=x.kToMFormat(a.data.totalSpace),t.storageInfo.percentage=Number((a.data.usedSpace/a.data.totalSpace*100).toFixed(1)),t.$store.commit("saveStorageInfo",a.data))}))},applyStorage:function(){this.isShowDialog=!0}},created:function(){this.checkLogin(),this.setActiveTab(),this.em.bind(_.UPDATE_STORAGE_INFO,this.getStorageInfo)},beforeDestroy:function(){this.em.unbind(_.UPDATE_STORAGE_INFO,this.getStorageInfo)}},T=D,I=(a("f04a"),Object(l["a"])(T,w,E,!1,null,"1a4ae14f",null)),A=I.exports,O=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("section",{staticClass:"book-classify-container"},[a("h4",[t._v("分类列表")]),t._l(t.classifies,(function(e,n){return a("ul",{key:n,staticClass:"book-classify-list"},[a("li",{staticClass:"classify-item",class:{"active-classify":e===t.classify},staticStyle:{cursor:"pointer"},on:{click:function(a){return t.showFileNodeInTable(e)}}},[t._v("\n                "+t._s(e)+"\n            ")])])}))],2),a("section",{staticClass:"book-table-container"},[a("el-table",{staticClass:"book-table",attrs:{data:t.tableData,stripe:!0}},[a("el-table-column",{attrs:{prop:"path",label:"书名",width:"240"}}),a("el-table-column",{attrs:{prop:"size",label:"文件大小",width:"120",formatter:t.formatSize}}),a("el-table-column",{attrs:{prop:"label","show-overflow-tooltip":!0,label:"标签",formatter:t.splitLabels}}),a("el-table-column",{attrs:{prop:"desc","show-overflow-tooltip":!0,label:"简介"}}),a("el-table-column",{attrs:{prop:"createDate",label:"日期",width:"240",formatter:t.formatDate}}),a("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"success"},on:{click:function(a){return t.downloadFile(e.row)}}},[t._v("下载")])]}}])})],1),a("div",{staticClass:"page-container"},[a("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":[10,20,30,40],"page-size":10,layout:"total, sizes, prev, pager, next, jumper",total:t.totalNum},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)])},$=[];a("ac4d"),a("8a81"),a("5df3"),a("1c4c"),a("6b54");function P(t,e){var a="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=F(t))||e&&t&&"number"===typeof t.length){a&&(t=a);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return s=t.done,t},e:function(t){r=!0,o=t},f:function(){try{s||null==a.return||a.return()}finally{if(r)throw o}}}}function F(t,e){if(t){if("string"===typeof t)return L(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?L(t,e):void 0}}function L(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}var R=15e3,U={name:"BookList",watch:{filterText:function(t){this.$refs.tree.filter(t)}},data:function(){return{filterText:"",defaultProps:{label:"label"},lastDownloadFileName:"",lastDownloadFileTime:0,classify:null,pagingQueryParam:{pageSize:10,currentPage:1},totalNum:0,currentPage:1,classifies:[],tableData:[]}},methods:{formatSize:function(t,e,a){return x.byteToMFormat(a)},formatDate:function(t,e,a){return x.formatDate(new Date(a),_.COMMON_DATE_FORMAT)},splitLabels:function(t,e,a){return x.splitLabels(a)},showFileNodeInTable:function(t){this.tableData=[],this.pagingQueryParam.pageSize=10,this.pagingQueryParam.currentPage=1,this.classify=t,this.queryBookList()},handleSizeChange:function(t){this.pagingQueryParam.pageSize=t,this.queryBookList()},handleCurrentChange:function(t){this.pagingQueryParam.currentPage=t,this.queryBookList()},queryBookList:function(){var t=this;this.axios({url:"/file/getPagingBook?classify="+this.classify+"&pageSize="+this.pagingQueryParam.pageSize+"&currentPage="+this.pagingQueryParam.currentPage,method:"get"}).then((function(e){0===e.data.code&&(t.totalNum=e.data.totalNum,t.tableData=e.data.data,t.$store.commit("saveClassify",t.classify))}))},queryClassifies:function(){var t=this;this.axios({url:"/file/getClassifyList"}).then((function(e){if(e.data.code===_.REQUEST_SUCCESS){var a,n=P(e.data.data);try{for(n.s();!(a=n.n()).done;){var i=a.value;t.classifies.push(i)}}catch(s){n.e(s)}finally{n.f()}var o=t.$store.getters.getClassify;null!==o?(t.classify=o,t.queryBookList()):t.classifies.length>0&&(t.classify=t.classifies[0],t.queryBookList())}}))},downloadFile:function(t){var e=(new Date).getTime()-this.lastDownloadFileTime;if(this.lastDownloadFileId===t.id&&e<R)this.$notify.warningEx({title:"无需重复下载，请稍候再试!"});else{this.lastDownloadFileId=t.id,this.lastDownloadFileTime=(new Date).getTime();var a=document.createElement("a");a.href="/file/downloadFile?id="+t.id,a.download=t.path,document.body.appendChild(a),a.click(),document.body.removeChild(a),this.$notify.successEx({title:"文件正在下载，请稍等"})}}},created:function(){this.queryClassifies()}},M=U,z=(a("3031"),Object(l["a"])(M,O,$,!1,null,"240b0dc6",null)),N=z.exports,j=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("el-table",{staticClass:"book-table",attrs:{data:t.tableData}},[a("el-table-column",{attrs:{type:"index"}}),a("el-table-column",{attrs:{prop:"path",label:"书名",width:"240"}}),a("el-table-column",{attrs:{prop:"classify",label:"分类",width:"120"}}),a("el-table-column",{attrs:{prop:"size",label:"文件大小",width:"120",formatter:t.formatSize}}),a("el-table-column",{attrs:{prop:"label","show-overflow-tooltip":!0,label:"标签",formatter:t.splitLabels}}),a("el-table-column",{attrs:{prop:"desc","show-overflow-tooltip":!0,label:"简介"}}),a("el-table-column",{attrs:{prop:"createDate",label:"上传日期",width:"200",formatter:t.formatDate}}),a("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary",size:"medium",disabled:!0}},[t._v("编辑")]),a("el-button",{attrs:{type:"danger"},on:{click:function(a){return t.deleteFile(e.row)}}},[t._v("删除")])]}}])})],1),a("div",{staticClass:"page-container"},[a("el-pagination",{attrs:{"current-page":t.pagingQueryParam.currentPage,"page-sizes":[10,20,30,40],"page-size":10,layout:"total, sizes, prev, pager, next, jumper",total:t.totalNum},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)},Q=[],q={name:"FileManagement",data:function(){return{tableData:[],totalNum:0,pagingQueryParam:{pageSize:10,currentPage:1}}},methods:{formatSize:function(t,e,a){return x.byteToMFormat(a)},formatDate:function(t,e,a){return x.formatDate(new Date(a),_.COMMON_DATE_FORMAT)},splitLabels:function(t,e,a){return x.splitLabels(a)},handleSizeChange:function(t){this.pagingQueryParam.pageSize=t,this.queryFileList()},handleCurrentChange:function(t){this.pagingQueryParam.currentPage=t,this.queryFileList()},queryFileList:function(){var t=this;this.axios({url:"/file/getPagingBook?pageSize="+this.pagingQueryParam.pageSize+"&currentPage="+this.pagingQueryParam.currentPage,method:"get"}).then((function(e){e.data.code===_.REQUEST_SUCCESS&&(t.totalNum=e.data.totalNum,t.tableData=e.data.data)}))},deleteFile:function(t){var e=this;this.axios({url:"/file/deleteFile?id="+t.id}).then((function(a){if(a.data.code===_.REQUEST_SUCCESS){var n=e.tableData.indexOf(t);if(-1!==n)return e.tableData.splice(n,1),e.$notify.successEx({title:"文件删除成功！"}),void e.em.fire(_.UPDATE_STORAGE_INFO)}e.$notify.errorEx({title:"文件删除失败！"})}))}},created:function(){this.queryFileList()}},B=q,V=(a("a17b"),Object(l["a"])(B,j,Q,!1,null,"579d42d2",null)),G=V.exports,H=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("el-upload",{ref:"upload",staticClass:"choose-file-container",attrs:{name:"file",action:t.uploadUrl,"on-success":t.uploadSuccess,"auto-upload":!1,"on-error":t.uploadError,"on-remove":t.removeFile,"on-change":t.fileStatusChange,limit:1,data:t.bookParam}},[a("el-button",{staticClass:"file-choose-btn",attrs:{slot:"trigger",size:"medium",type:"primary"},slot:"trigger"},[a("em",{staticClass:"el-icon-upload"}),a("span",[t._v("选取文件")])])],1),a("div",{staticClass:"classify-input-container"},[a("span",[t._v("书籍分类(必选)")]),a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.selectedClassify,callback:function(e){t.selectedClassify=e},expression:"selectedClassify"}},[a("el-input",{attrs:{placeholder:"自定义选项，回车确定"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addClassify.apply(null,arguments)}},model:{value:t.userDefinedClassify,callback:function(e){t.userDefinedClassify=e},expression:"userDefinedClassify"}}),t._l(t.classifies,(function(t){return a("el-option",{key:t,attrs:{value:t}})}))],2)],1),a("div",{staticClass:"label-input-container"},[a("div",[a("span",[t._v("添加书籍标签(可选)")]),a("el-tooltip",{attrs:{effect:"light",content:"填写概述标签，方便大家准确找书，也利于平台在后期上线推荐系统！",placement:"right"}},[a("em",{staticClass:"el-icon-question"})])],1),t._l(t.tags,(function(e){return a("el-tag",{key:e,attrs:{closable:"","disable-transitions":!1},on:{close:function(a){return t.closeTag(e)}}},[t._v("\n            "+t._s(e)+"\n        ")])})),t.tagInputVisible?a("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:t.addTag},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addTag.apply(null,arguments)}},model:{value:t.tagValue,callback:function(e){t.tagValue=e},expression:"tagValue"}}):a("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:t.showInput}},[t._v("+ 新标签")])],2),a("div",{staticClass:"desc-input-container"},[a("span",[t._v("内容简介(可选)")]),a("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"请输入内容"},model:{value:t.bookParam.desc,callback:function(e){t.$set(t.bookParam,"desc",e)},expression:"bookParam.desc"}})],1),a("el-button",{staticClass:"upload-btn",attrs:{type:"success"},on:{click:t.submitUpload}},[t._v("开始上传")])],1)},J=[],W=a("2909"),Y=5,Z={name:"FIleUpload",data:function(){return{bookParam:{classify:"",labels:"",desc:""},uploadUrl:"/file/uploadFile",file:null,selectedClassify:"",isClassifyAdded:!1,userDefinedClassify:"",tagInputVisible:!1,tagValue:"",tags:[],classifies:[],isStorageAllow:!1}},methods:{submitUpload:function(){null!==this.file?this.checkStorage()&&(""!==this.selectedClassify?this.checkFileNameAndUpload():this.$notify.warningEx({title:"未选择分类"})):this.$notify.warningEx({title:"未选择任何文件！"})},closeTag:function(t){this.tags.splice(this.tags.indexOf(t),1)},showInput:function(){var t=this;this.tagInputVisible=!0,this.$nextTick((function(){t.$refs.saveTagInput.$refs.input.focus()}))},uploadError:function(){this.$notify.errorEx({title:"电子书上传失败！"})},uploadSuccess:function(t){t.code===_.REQUEST_SUCCESS&&this.$notify.successEx({title:"电子书上传成功！"}),this.$refs.upload.clearFiles(),this.file=null,this.tags=[],this.em.fire(_.UPDATE_STORAGE_INFO)},checkFileNameAndUpload:function(){var t=this,e=this;this.axios({url:"/file/isFileNameExist?name="+this.file.name,method:"get"}).then((function(a){!0===a.data?e.$notify.warningEx({title:"该书已存在！"}):(e.bookParam.classify=t.selectedClassify,e.bookParam.labels=e.tags.join(_.LABELS_SEPARATOR),e.$refs.upload.submit())}))},addTag:function(){if(this.tagInputVisible=!1,""!==this.tagValue)if(this.tags.length>=Y)this.$notify.warningEx({title:"描述标签最大个数为："+Y});else if(-1===this.tags.indexOf(this.tagValue)){var t=this.tagValue;t&&this.tags.push(t),this.tagValue=""}else this.$notify.warningEx({title:"该标签已经存在，无需重复添加"})},removeFile:function(){this.file=null},checkStorage:function(){var t=this.$store.getters.getStorageInfo,e=t.totalSpace-t.usedSpace;return!(x.kToM(this.file.size)>e)||(this.$notify.warningEx({title:"存储空间不足",content:"鼠标指向用户名，可显示存储空间申请按钮。"}),!1)},fileStatusChange:function(t){this.file=t},addClassify:function(){if(this.userDefinedClassify.length<2||this.userDefinedClassify.length>10)this.$notify.errorEx({title:"自定义选项长度应为2 - 10"});else{if(-1!==this.classifies.indexOf(this.userDefinedClassify))return this.selectedClassify=this.userDefinedClassify,void this.$notify.successEx({title:"选项"+this.userDefinedClassify+"已经存在，选择成功"});if(this.isClassifyAdded)return this.classifies.splice(0,1,this.userDefinedClassify),void(this.selectedClassify=this.userDefinedClassify);this.classifies.unshift(this.userDefinedClassify),this.isClassifyAdded=!0,this.selectedClassify=this.userDefinedClassify}},queryClassifies:function(){var t=this,e=this;this.axios({url:"/file/getClassifyList"}).then((function(a){var n;a.data.code===_.REQUEST_SUCCESS&&((n=e.classifies).splice.apply(n,[0,t.classifies.length-1].concat(Object(W["a"])(a.data.data))),0===e.classifies.length&&e.classifies.push(""))}))}},created:function(){this.queryClassifies()}},X=Z,K=(a("1a39"),Object(l["a"])(X,H,J,!1,null,"4c744507",null)),tt=K.exports;n["default"].use(p["a"]);var et=new p["a"]({routes:[{name:"index",path:"/",redirect:"/login"},{name:"login",path:"/login",component:C},{name:"main",path:"/main",component:A,redirect:{name:"bookList"},children:[{name:"bookList",path:"/book-list",component:N},{name:"bookManagement",path:"/book-manage",component:G},{name:"bookUpload",path:"/book-upload",component:tt}]}]}),at=et,nt=a("bc3a"),it=a.n(nt),ot={SUCCESS:"success",WARNING:"warning",INFO:"info",ERROR:"error"},st={register:function(t){t.prototype.$notify.successEx=function(e){Object.assign(e,{type:ot.SUCCESS}),rt(t,e)},t.prototype.$notify.warningEx=function(e){Object.assign(e,{type:ot.WARNING}),rt(t,e)},t.prototype.$notify.infoEx=function(e){Object.assign(e,{type:ot.INFO}),rt(t,e)},t.prototype.$notify.errorEx=function(e){Object.assign(e,{type:ot.ERROR}),rt(t,e)}}};function rt(t,e){t.prototype.$notify({type:e.type,title:e.title,message:e.content,position:"bottom-right"})}a("ac6a"),a("f400");function lt(t,e){var a="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=ct(t))||e&&t&&"number"===typeof t.length){a&&(t=a);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return s=t.done,t},e:function(t){r=!0,o=t},f:function(){try{s||null==a.return||a.return()}finally{if(r)throw o}}}}function ct(t,e){if(t){if("string"===typeof t)return ut(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?ut(t,e):void 0}}function ut(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}function ft(){this.eventsMap=new Map}ft.prototype={bind:function(t,e){this.eventsMap.has(t)||this.eventsMap.set(t,[]),this.eventsMap.get(t).push(e)},unbind:function(t,e){var a=this.eventsMap.get(t);void 0===a&&(void 0===e?a.length=0:a.forEach((function(t,n){t===e&&a.splice(n,1)})))},fire:function(t){for(var e=arguments.length,a=new Array(e>1?e-1:0),n=1;n<e;n++)a[n-1]=arguments[n];var i,o=lt(this.eventsMap.get(t));try{for(o.s();!(i=o.n()).done;){var s=i.value;s.call.apply(s,[this].concat(a))}}catch(r){o.e(r)}finally{o.f()}}};var dt=new ft,pt=a("2f62"),ht=a("7a8e"),gt=a.n(ht),mt="session-storage",yt={state:{userInfo:null,classify:null,storageInfo:null},mutations:{saveUserInfo:function(t,e){t.userInfo=e.userInfo},saveClassify:function(t,e){t.classify=e},saveStorageInfo:function(t,e){t.storageInfo=e}},getters:{getUserInfo:function(t){return t.userInfo},getClassify:function(t){return t.classify},getStorageInfo:function(t){return t.storageInfo}}},bt=sessionStorage.getItem(mt);function vt(){window.removeEventListener("beforeunload",vt),sessionStorage.setItem(mt,JSON.stringify(yt.state))}bt&&bt.length>0&&Object.assign(yt.state,JSON.parse(bt)),window.addEventListener("beforeunload",vt);var St=yt;n["default"].use(pt["a"]);var Ct=new pt["a"].Store({modules:{localState:gt.a,sessionState:St}});n["default"].config.productionTip=!1,n["default"].use(d.a),st.register(n["default"]),n["default"].prototype.axios=it.a.create({baseURL:"",crossDomain:!0}),n["default"].prototype.em=dt,new n["default"]({store:Ct,router:at,render:function(t){return t(u)}}).$mount("#app")},"5e23":function(t,e,a){},6768:function(t,e,a){},"7a8e":function(t,e){},a17b:function(t,e,a){"use strict";a("c196")},ae2b:function(t,e,a){"use strict";a("b882")},b00f:function(t,e,a){},b245:function(t,e,a){},b882:function(t,e,a){},c196:function(t,e,a){},efc5:function(t,e,a){"use strict";a("b00f")},f04a:function(t,e,a){"use strict";a("6768")}});
//# sourceMappingURL=app.0d815797.js.map